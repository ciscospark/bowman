#!/usr/bin/env node

// TODO move exit code definitions to a separate file
const E_UNHANDLED_REJECTION = 64;

// FIXME: NODE_ENV isn't going to be set in "production" enviroments
const DEV = process.env.NODE_ENV === 'development';

if (DEV) {
  /* eslint-disable global-require */
  /* eslint-disable import/no-unassigned-import */
  /* eslint-disable import/no-extraneous-dependencies */
  require('babel-register');

}

// eslint-disable-next-line no-unused-expressions
const {argv} = require('yargs')
  .options({
    debug: {
      default: false,
      description: 'Print stacktraces',
      type: 'boolean'
    }
  })
  .env('')
  .commandDir(DEV ? '../src/commands' : '../cjs/commands')
  .demandCommand(1)
  .help();

process.on('unhandledRejection', (err) => {
  const cmd = `bowman ${process.argv.slice(2)
    .join(' ')}`;
  console.error(`Failed to execute "${cmd}"`);
  console.error(err.toString());
  if (argv.debug || DEV) {
    console.error(err);
  }
  // eslint-disable-next-line no-process-exit
  process.exit(E_UNHANDLED_REJECTION);
});
